<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>examplepage</title>
  </head>
  <script>
    const textEncoder = new TextEncoderStream();
    const textDecoder = new TextDecoderStream();
    const reader = textDecoder.readable.getReader();
    const writer = textEncoder.writable.getWriter();
    const command = document.getElementById('command');
    const result = document.getElementById('result');

    document.getElementById('send').addEventListener('click', async () => {
      await writer.write(command.value);
    });
    
    document.getElementById('connect').addEventListener('click', async () => { // 'async' 키워드를 추가하여 비동기 함수로 변경
      const port = await navigator.serial.requestPort();
      // Wait for the serial port to open.
      await port.open({ baudRate: 9600 });

      const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);
      const writableStreamClosed = textEncoder.readable.pipeTo(port.writable);

      // 직렬 장치에서 오는 데이터를 듣는다.
      while (true) {
        const { value, done } = await reader.read();
        if (done) {
          // 나중에 시리얼 포트가 닫힐 수 있도록 해준다.
          reader.releaseLock();
          break;
        }
        result.value = value;
      }
    });

    if ("serial" in navigator) alert("Your browser supports Web Serial API!");
    else alert("Your browser does not support Web Serial API, the latest version of Google Chrome is recommended!");
  </script>
  <body>
   <button id="connect">Connect</button>
   <br>
   <input type="text" id="command">
   <button id="send">Send</button>
   <br>
   <span id="result'></span>
  </body>
</html>
